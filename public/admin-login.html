<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Login</title>
        <style>
            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
                    sans-serif;
                background-color: #f9fafb;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                margin: 0;
            }
            .login-container {
                background: white;
                padding: 40px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                width: 100%;
                max-width: 400px;
            }
            .login-container h1 {
                text-align: center;
                color: #1f2937;
                margin-bottom: 30px;
            }
            .form-group {
                margin-bottom: 20px;
            }
            .form-group label {
                display: block;
                margin-bottom: 5px;
                color: #374151;
                font-weight: 500;
            }
            .form-group input {
                width: 100%;
                padding: 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                font-size: 16px;
                box-sizing: border-box;
            }
            .form-group input:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            .login-btn {
                width: 100%;
                padding: 12px;
                background-color: #3b82f6;
                color: white;
                border: none;
                border-radius: 6px;
                font-size: 16px;
                font-weight: 500;
                cursor: pointer;
                transition: background-color 0.2s;
            }
            .login-btn:hover {
                background-color: #2563eb;
            }
            .login-btn:disabled {
                background-color: #9ca3af;
                cursor: not-allowed;
            }
            .error {
                background-color: #fef2f2;
                border: 1px solid #fecaca;
                color: #dc2626;
                padding: 12px;
                border-radius: 6px;
                margin-bottom: 20px;
                display: none;
            }
            .success {
                background-color: #f0fdf4;
                border: 1px solid #bbf7d0;
                color: #16a34a;
                padding: 12px;
                border-radius: 6px;
                margin-bottom: 20px;
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="login-container">
            <h1>Admin Login</h1>

            <div id="error" class="error"></div>
            <div id="success" class="success"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required />
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        required
                    />
                </div>

                <button type="submit" class="login-btn" id="loginBtn">
                    Login
                </button>
            </form>
        </div>

        <script>
            // Test admin routes on page load
            window.addEventListener('load', async () => {
                try {
                    const testResponse = await fetch('/api/admin/test');
                    const testData = await testResponse.json();
                    console.log('Admin routes test:', testData);
                } catch (error) {
                    console.error('Admin routes test failed:', error);
                }
            });

            document
                .getElementById('loginForm')
                .addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    const loginBtn = document.getElementById('loginBtn');
                    const errorDiv = document.getElementById('error');
                    const successDiv = document.getElementById('success');

                    // Hide previous messages
                    errorDiv.style.display = 'none';
                    successDiv.style.display = 'none';

                    // Disable button
                    loginBtn.disabled = true;
                    loginBtn.textContent = 'Logging in...';

                    try {
                        console.log('Attempting to login with:', {
                            email,
                            password: '***',
                        });

                        const response = await fetch(
                            '/api/admin-auth/admin-login',
                            {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ email, password }),
                            }
                        );

                        console.log('Response status:', response.status);
                        console.log('Response headers:', response.headers);

                        const data = await response.json();
                        console.log('Response data:', data);

                        if (data.success) {
                            // Store token
                            localStorage.setItem('adminToken', data.token);
                            sessionStorage.setItem('adminToken', data.token);

                            successDiv.textContent =
                                'Login successful! Redirecting...';
                            successDiv.style.display = 'block';

                            // Redirect to recovery key requests page
                            setTimeout(() => {
                                window.location.href =
                                    '/admin-recovery-key-requests.html';
                            }, 1000);
                        } else {
                            errorDiv.textContent =
                                data.message || 'Login failed';
                            errorDiv.style.display = 'block';
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        errorDiv.textContent = `Error: ${error.message}. Please check the console for details.`;
                        errorDiv.style.display = 'block';
                    } finally {
                        // Re-enable button
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Login';
                    }
                });
        </script>
    </body>
</html>
